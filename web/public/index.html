<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RAWAR Soul Studio</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        button { padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>RAWAR Soul Studio</h1>
    <h2>Record Vocals</h2>
    <button id="recordBtn">Start Recording</button>
    <button id="stopBtn" disabled>Stop</button>
    <audio id="playback" controls></audio>

    <h2>Upload Beat (MP3)</h2>
    <input type="file" id="beatFile" accept="audio/mpeg" />
    <button id="uploadBtn">Upload</button>
    <p id="uploadStatus"></p>

    <p>To create a QR code for a link, visit <code>/qr?url=YOUR_URL</code>.</p>

    <script>
    let mediaRecorder, audioChunks = [];
    const recordBtn = document.getElementById('recordBtn');
    const stopBtn = document.getElementById('stopBtn');
    const playback = document.getElementById('playback');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadStatus = document.getElementById('uploadStatus');

    recordBtn.onclick = async () => {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();
        audioChunks = [];
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        recordBtn.disabled = true;
        stopBtn.disabled = false;
    };

    stopBtn.onclick = () => {
        mediaRecorder.stop();
        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks);
            playback.src = URL.createObjectURL(audioBlob);
        };
        recordBtn.disabled = false;
        stopBtn.disabled = true;
    };

    uploadBtn.onclick = () => {
        const file = document.getElementById('beatFile').files[0];
        if (!file) return alert('Select a beat file');
        const formData = new FormData();
        formData.append('beat', file);
        fetch('/upload-beat', { method: 'POST', body: formData })
            .then(res => res.json())
            .then(data => {
                uploadStatus.textContent = 'Uploaded as ' + data.file;
            })
            .catch(err => {
                uploadStatus.textContent = 'Upload failed';
            });
    };
    </script>
</body>
</html>
